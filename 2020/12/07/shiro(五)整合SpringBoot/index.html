<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="大道至简"><title>Shiro入门(五)：整合SpringBoot | 岳争</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Shiro入门(五)：整合SpringBoot</h1><a id="logo" href="/.">岳争</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Shiro入门(五)：整合SpringBoot</h1><div class="post-meta">2020-12-07<span> | </span><span class="category"><a href="/categories/Shiro/">Shiro</a></span></div><div class="post-content"><h1 id="Shiro-五-：整合SpringBoot"><a href="#Shiro-五-：整合SpringBoot" class="headerlink" title="Shiro(五)：整合SpringBoot"></a>Shiro(五)：整合SpringBoot</h1><h2 id="一、整合思路"><a href="#一、整合思路" class="headerlink" title="一、整合思路"></a>一、整合思路</h2><p>​        在我们传统的应用开发中，只要用户登陆成功，就可以肆无忌惮的操作里面的资源，这样安全性非常的低，所以我们要整合<code>Shiro</code>决定那些用户可以操作那些资源！</p>
<img src="https://i0.hdslb.com/bfs/album/e78c5840afee3c95a4c9b733e723b23248176ccb.png@518w.png" alt="image-20201205142630164" style="zoom:80%;" />



<p>如果想要用<code>Shiro</code>管理我们的资源，首先要做到第一点，我们要把我们所有的请求交给<code>Shiro</code>来进行处理。用户发起请求时，先经过<code>Shiro</code>的认证，然后进入系统后</p>
<p>在进行<code>Shiro</code>中的授权。</p>
<h2 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h2><ol>
<li><p>新建一个<code>SpringBoot</code>项目，导入相关依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>搭建前端页面，这里我使用的<code>layui</code>搭建了几个简单丑陋的页面作为方便测试</p>
<p>登陆页：</p>
<img src="https://i0.hdslb.com/bfs/album/1357fb48974decf5c2d4f9720bafd0a8e2d4393d.png@518w.png" alt="image-20201205155240909" style="zoom:67%;" />

<p>后台页：</p>
<img src="https://i0.hdslb.com/bfs/album/f11a5baf475c6c51e2f5f898cf69dca87ba602e1.png@518w.png" alt="image-20201205155934232" style="zoom:67%;" />

<p><code>vip1</code>页：</p>
<img src="https://i0.hdslb.com/bfs/album/f31de377f1b49e08567a33f8cf1a5e3a7273c1f0.png@518w.png" alt="image-20201206163155351" style="zoom:67%;" />

<p><code>vip2</code>页：</p>
<img src="https://i0.hdslb.com/bfs/album/dcb5dd34ffc008682c6fdd6574c54d90ab11b503.png@518w.png" alt="image-20201206163209666" style="zoom:67%;" />

<p><code>vip3、vip4</code>页面也都如此</p>
<p><strong>注：</strong><code>页面所有相关代码都在该文章底部网盘中获取</code></p>
</li>
<li><p>构建相应的页面跳转控制器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageController</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 登陆页</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &#123;&quot;/&quot;,&quot;/login&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 登陆认证</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/toLogin&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toLogin</span><span class="params">(String username,String password)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 这里先不做 账号密码的逻辑处理</span></span><br><span class="line">        System.out.println(<span class="string">&quot;登陆的用户名:&quot;</span>+username);</span><br><span class="line">        System.out.println(<span class="string">&quot;登陆的密码:&quot;</span>+password);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 后台首页</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;进入首页&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// vip1页面</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/vip1&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">vip1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;进入VIP1&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;vip1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> 	<span class="comment">// vip2页面</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/vip2&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">vip2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;进入VIP2&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;vip2&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// vip3页面</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/vip3&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">vip3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;进入VIP3&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;vip3&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// vip4页面</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/vip4&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">vip4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;进入VIP4&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;vip4&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>配置一个<code>Shiro</code>的配置类：<code>ShiroConfig.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Shiro核心配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 创建 ShrioFilter</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 创建安全管理器</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 创建自定义 Realm</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        因为它是一个配置类所以千万要加上<code>@Cofniguration</code>注解，否则配置类不会生效，根据上面的整合思路分析，我们一共要先构建<code>ShiroFilter</code>、<code>安全管理器</code>和<code>自定义Realm</code>三个对象。</p>
<ul>
<li><p><code>ShiroFilter</code> 我们可以通过<code>ShiroFilterFactoryBean</code>来构建，<code>ShiroFilterFactoryBean</code>实现了<code>FactoryBean</code>、<code>BeanPostProcessor</code>接口，它的作用就是负责拦截所有请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 创建 ShrioFilter</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">getShiroFilterFactoryBean</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ShiroFilterFactoryBean shiroFilterFactoryBean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">    <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在<code>Web</code>环境下面，我们不能再创建<code>SecurityManager</code>作为安全管理器了，而是创建<code>DefaultWebSecurityManager</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 创建安全管理器</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">getDefaultWebSecurityManager</span><span class="params">()</span></span>&#123;</span><br><span class="line">    DefaultWebSecurityManager defaultWebSecurityManager = <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line">    <span class="keyword">return</span> defaultWebSecurityManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>最后一步就是创建自定义<code>Realm</code>用来获取数据信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3. 创建自定义 Realm</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Realm <span class="title">getRealm</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 这里我们还没有自定义我们的Realm类 所以暂且让它返回null</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><code>ShiroFilterFactoryBean</code>、<code>Security</code>与<code>Reakn</code>是相互依赖的，接下来就设置他们的依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 创建 ShrioFilter</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">getShiroFilterFactoryBean</span><span class="params">(DefaultWebSecurityManager defaultWebSecurityManager)</span></span>&#123;</span><br><span class="line">        ShiroFilterFactoryBean shiroFilterFactoryBean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 给 ShiroFilterFactoryBean 设置安全管理器</span></span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(defaultWebSecurityManager);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 创建安全管理器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">getDefaultWebSecurityManager</span><span class="params">(Realm realm)</span></span>&#123;</span><br><span class="line">        DefaultWebSecurityManager defaultWebSecurityManager = <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 给 SecurityManager 设置 realm</span></span><br><span class="line">        defaultWebSecurityManager.setRealm(realm);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> defaultWebSecurityManager;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. 创建自定义 Realm</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Realm <span class="title">getRealm</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>这时我们的<code>Realm</code>还没有设置，接下来简单的自定义一个<code>Realm</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义 Realm</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后设置到<code>ShiroConfig</code>中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3. 创建自定义 Realm</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Realm <span class="title">getRealm</span><span class="params">()</span></span>&#123;</span><br><span class="line">    MyRealm realm = <span class="keyword">new</span> MyRealm();</span><br><span class="line">    <span class="keyword">return</span> realm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​        现在一个基本的框架就已经搭建完成了，启动我们的程序也没有报错，但是这时我们访问项目中的所有资源都可以访问，因为这时我没还没有告诉<code>Shiro</code>那些资源可以访问，那些资源需要认证！</p>
<h2 id="三、认证的基本操作"><a href="#三、认证的基本操作" class="headerlink" title="三、认证的基本操作"></a>三、认证的基本操作</h2><p>​        现在我们所有的资源都已经被<code>Shiro</code>管理，但是这时我们要告诉<code>Shiro</code>那些资源是公共资源，那些资源是受限资源，这样<code>Shiro</code>才可以帮我们实现请求的拦截：</p>
<h3 id="3-1-资源的权限设置"><a href="#3-1-资源的权限设置" class="headerlink" title="3.1 资源的权限设置"></a>3.1 资源的权限设置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">getShiroFilterFactoryBean</span><span class="params">(DefaultWebSecurityManager defaultWebSecurityManager)</span></span>&#123;</span><br><span class="line">    ShiroFilterFactoryBean shiroFilterFactoryBean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 给 ShiroFilterFactoryBean 设置安全管理器</span></span><br><span class="line">    shiroFilterFactoryBean.setSecurityManager(defaultWebSecurityManager);</span><br><span class="line">    shiroFilterFactoryBean.setLoginUrl(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">    <span class="comment">// 设置 受限资源</span></span><br><span class="line">    HashMap&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;/index&quot;</span>,<span class="string">&quot;authc&quot;</span>);  <span class="comment">// 请求这个资源要认证授权</span></span><br><span class="line">    map.put(<span class="string">&quot;/vip1&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;/vip2&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;/vip3&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;/vip4&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">    shiroFilterFactoryBean.setFilterChainDefinitionMap(map);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        我们可以通过<code>ShiroFilterFactoryBean.setFilterChainDefinitionMap()</code>方法来设置资源的访问权限，它的参数是一个<code>Map</code>集合，所以我们要创建一个<code>Map</code>集合，把要认证的资源<code>put</code>到<code>map</code>中，<code>key</code>为要认证的资源，*<code>value</code>为资源<code>authc</code>代表请求这个资源要通过认证和授权*。如果没有进行认证则会默认跳转到<code>login.jsp</code>页面，因为我们使用的是<code>Thymeleaf</code>模板所以没有<code>login.jsp</code>页面，我们要通过<code>ShiroFilterFactoryBean.setLoginURL()</code>来设置自定义登陆页，参数为登陆的请求路径。这样我们访问这些受限资源就会拦截并跳转到<code>/login</code>请求。</p>
<h3 id="3-2-常见过滤器"><a href="#3-2-常见过滤器" class="headerlink" title="3.2 常见过滤器"></a>3.2 常见过滤器</h3><p>​        在上面设置那些资源需要通过认证的过程中，我们用到了一个<code>authc</code>的值为<code>value</code>，它实际是一个过滤器的简称，在<code>Shiro</code>中给我们提供了很多的过滤器来让我们这样方便的使用：</p>
<table>
<thead>
<tr>
<th>配置缩写</th>
<th>对应的过滤器</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td><code>anon</code></td>
<td><code>AnonymousFilter</code></td>
<td>指定可以匿名访问，也就是无需认证即可访问</td>
</tr>
<tr>
<td><code>authc</code></td>
<td><code>FormAuthenticationFilter</code></td>
<td>指定<code>URL</code>需要<code>Form</code>表单登陆，默认会从请求中获取<code>username</code>、<code>password</code>、<code>rememberMe</code>等登陆参数，如果没有进行登陆访问，则跳转到<code>LoginUrl</code>所匹配的路径</td>
</tr>
<tr>
<td><code>authcBasic</code></td>
<td><code>BasicHttpAuthenticationFilter</code></td>
<td>指定<code>URL</code>需要<code>Basic</code>登陆</td>
</tr>
<tr>
<td><code>logout</code></td>
<td><code>LoginFilter</code></td>
<td>退出过滤器，配置指定<code>URL</code>就可以实现退出功能</td>
</tr>
<tr>
<td><code>noSessionCreation</code></td>
<td><code>NoSessionCreationFilter</code></td>
<td>进制创建会话</td>
</tr>
<tr>
<td><code>perms</code></td>
<td><code>PermissionsAuthorizationFilter</code></td>
<td>需要指定权限才能访问</td>
</tr>
<tr>
<td><code>port</code></td>
<td><code>PortFilter</code></td>
<td>需要指定端口才能访问</td>
</tr>
<tr>
<td><code>rest</code></td>
<td><code>HttpMethodPermissionFilter</code></td>
<td>将<code>Http</code>请求方法转换成相应的动词构造一个权限字符串</td>
</tr>
<tr>
<td><code>roles</code></td>
<td><code>RolesAuthorizationFilter</code></td>
<td>需要指定角色才能访问</td>
</tr>
<tr>
<td><code>ssl</code></td>
<td><code>SslFtilter</code></td>
<td>需要<code>Http</code>请求才能访问</td>
</tr>
<tr>
<td><code>user</code></td>
<td><code>UserFilter</code></td>
<td>需要已登录或记住我的用户才能访问</td>
</tr>
</tbody></table>
<h3 id="3-3-认证设置"><a href="#3-3-认证设置" class="headerlink" title="3.3 认证设置"></a>3.3 认证设置</h3><p>​        在<code>3.1</code>中我们设置了那些资源需要认证才可以访问，现在我们就要实现认证的流程，对登陆的请求进行完善</p>
<ol>
<li><p>在登陆请求中获取登陆主体</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/toLogin&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toLogin</span><span class="params">(String username,String password)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;登陆的用户名:&quot;</span>+username);</span><br><span class="line">    System.out.println(<span class="string">&quot;登陆的密码:&quot;</span>+password);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 获取主体对象</span></span><br><span class="line">    Subject subject = SecurityUtils.getSubject();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        在之前我们使用<code>SecurityUtils</code>需要注入安全管理器，但是在这里我们没有注入安全管理器可以直接使用么？在<code>Web</code>环境中，只要我们在<code>ShiroConfig</code>中创建了安全管理器，它就会自定注入安全管理器，这里就可以直接使用<code>SecurityUtils</code>。</p>
</li>
<li><p>使用<code>Subject</code>实现认证</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/toLogin&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toLogin</span><span class="params">(String username,String password)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;登陆的用户名:&quot;</span>+username);</span><br><span class="line">    System.out.println(<span class="string">&quot;登陆的密码:&quot;</span>+password);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 获取主体对象</span></span><br><span class="line">    Subject subject = SecurityUtils.getSubject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 登陆认证</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        subject.login(<span class="keyword">new</span> UsernamePasswordToken(username,password));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/index&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnknownAccountException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        System.out.println(<span class="string">&quot;用户名错误&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IncorrectCredentialsException e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        System.out.println(<span class="string">&quot;密码错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/login&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        这里我们就可以使用<code>Subject.login()</code>方法直接登陆，但是要把用户名和密码封装到<code>token</code>中，如果认证通过跳转到后台<code>inde.html</code>页面，如果认证失败抛出异常则跳转到<code>login.html</code>登录页</p>
</li>
<li><p>设置<code>Realm</code>中的认证过程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;开始认证&quot;</span>);</span><br><span class="line">    <span class="comment">// 1. 获得主体信息</span></span><br><span class="line">    String principal = (String) token.getPrincipal();</span><br><span class="line">    System.out.println(principal+<span class="string">&quot;进行认证&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span>.equals(principal))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(principal,<span class="string">&quot;qwe&quot;</span>,<span class="keyword">this</span>.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        首先通过<code>token.getPrincipal()</code>获取主体信息，然后认证主体信息是否正确，如果主体信息正确，返回一个<code>SimpleAuthenticationInfo</code>对象继续认证密码，否则认证失败。</p>
</li>
<li><p>启动项目进行测试</p>
<img src="https://i0.hdslb.com/bfs/album/3b415d2130e191cf46b34513c7214cb07522ec9f.png@518w.png" alt="image-20201206162940742" style="zoom:67%;" />

<p>输入<code>admin</code>与<code>qwe</code>进行登陆</p>
<img src="https://i0.hdslb.com/bfs/album/dcb5dd34ffc008682c6fdd6574c54d90ab11b503.png@518w.png" alt="image-20201206163209666" style="zoom:67%;" />

<p>控制台输出：</p>
<img src="https://i0.hdslb.com/bfs/album/1c0f5fe3fb481c321227566f1cd265dde1223f27.png@518w.png" alt="image-20201206163034056" style="zoom:67%;" /></li>
</ol>
<h3 id="3-4-退出登陆"><a href="#3-4-退出登陆" class="headerlink" title="3.4 退出登陆"></a>3.4 退出登陆</h3><ol>
<li>若想实现退出登陆我们要在所有后台的页面中添加一个退出按钮：</li>
</ol>
<img src="https://i0.hdslb.com/bfs/album/431359e13e8f97ed0fe54cba10014bd131f23d66.png@518w.png" alt="image-20201206164413976" style="zoom:67%;" />

<ol start="2">
<li><p>编写退出登陆控制器<code>/logout</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/logout&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;退出登陆&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取主体</span></span><br><span class="line">    Subject subject = SecurityUtils.getSubject();</span><br><span class="line">    subject.logout();   <span class="comment">// 退出登陆</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/login&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Shiro</code>实现用户退出十分简单，只需要拿到主体对象，调用主体的<code>logout</code>方法即可实现退出，退出后我们让它重定向登陆页面即可</p>
</li>
<li><p>运行测试</p>
<img src="https://i0.hdslb.com/bfs/album/c7939cb5aefd50c775969fcac6d618f6a36790ed.png@518w.png" alt="image-20201206165222388" style="zoom:67%;" />

<p>点击退出按钮</p>
<img src="https://i0.hdslb.com/bfs/album/77b0b561cfad158dc1ef3f904a5b4850555ad9a0.png@518w.png" alt="image-20201206165245981" style="zoom:67%;" />

<p>观察控制台输出</p>
<img src="https://i0.hdslb.com/bfs/album/8369b1c66999d66508eaeaa700e3b951f8b7ff07.png@518w.png" alt="image-20201206165328604" style="zoom:67%;" /></li>
</ol>
<h3 id="3-5-使用数据库实现基于MD5-Salt注册"><a href="#3-5-使用数据库实现基于MD5-Salt注册" class="headerlink" title="3.5 使用数据库实现基于MD5+Salt注册"></a>3.5 使用数据库实现基于MD5+Salt注册</h3><ol>
<li><p>首先我们先简单创建一个注册页面</p>
<img src="https://i0.hdslb.com/bfs/album/309b6a87cb9cdf99b36cd6596d2245e329ac77dc.png@518w.png" alt="image-20201206172032111" style="zoom:67%;" /></li>
<li><p>因为我们要连接数据库，首先建立一张<code>t_user</code>表，表中数据如下：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>username</th>
<th>password</th>
<th>salt</th>
<th align="left">role</th>
<th>perms</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>admin</td>
<td>qwe</td>
<td></td>
<td align="left"></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>root</td>
<td>qwe</td>
<td></td>
<td align="left"></td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p>导入<code>Mybatis-plus</code>，并配置相应的配置</p>
<p><code>pom.xml</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;3.4.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p><code>application.yaml</code>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">thymeleaf:</span></span><br><span class="line">    <span class="attr">cache:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/shiro?useSSL=true&amp;useUncode=true&amp;charaterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">147110</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">org.springframework.jdbc.datasource.DriverManagerDataSource</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">typeAliasesPackage:</span> <span class="string">com.yue.entity</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br></pre></td></tr></table></figure></li>
<li><p>在<code>com.yue.entity</code>中构建一个实体类<code>User</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableName(&quot;t_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(&quot;username&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(&quot;password&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(&quot;salt&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String salt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(&quot;role_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer roleId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(&quot;auth_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer authId;</span><br><span class="line">	....	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>因为我们要用到随机盐，我们要创建一个随机盐的工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SaltUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSalt</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span>[] chars = <span class="string">&quot;asdfghjklqwertyuiopzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM1234567890@#$%&amp;*/-+()&quot;</span>.toCharArray();</span><br><span class="line"></span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> achar = chars[<span class="keyword">new</span> Random().nextInt(chars.length)];</span><br><span class="line">            sb.append(achar);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>创建<code>mapper</code>接口，因为我们用的<code>Mybatis-plus</code>所以要实现<code>BaseMapper</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>编写<code>Service</code>层</p>
<p><code>IUserService</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户注册</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.lang.Integer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">insertUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>UserServiceImpl</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">IUserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户注册</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.lang.Integer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">insertUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        String salt = SaltUtil.getSalt(<span class="number">8</span>);</span><br><span class="line">        <span class="comment">// 使用 shiro 提供的 MD5工具类 来封装密码</span></span><br><span class="line">        Md5Hash md5Hash = <span class="keyword">new</span> Md5Hash(user.getPassword(),salt,<span class="number">1024</span>);</span><br><span class="line">        user.setPassword(md5Hash.toHex());</span><br><span class="line">        <span class="keyword">int</span> insert = userMapper.insert(user);</span><br><span class="line">        <span class="keyword">return</span> insert;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>编写<code>Controller</code>控制器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisteredController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/registered&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">registered</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;进入注册&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;registered&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/toRegistered&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toRegistered</span><span class="params">(String username,String password)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;开始注册&quot;</span>);</span><br><span class="line"></span><br><span class="line">        User user = <span class="keyword">new</span> User(username, password);</span><br><span class="line">        Integer integer = userService.insertUser(user);</span><br><span class="line">        <span class="keyword">if</span> (integer==<span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;注册失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;注册成功&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/login&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-6-使用数据库完善认证操作"><a href="#3-6-使用数据库完善认证操作" class="headerlink" title="3.6 使用数据库完善认证操作"></a>3.6 使用数据库完善认证操作</h3><p>​        认证整合数据库也就是我们的用户信息存放在数据库中，用户的登陆则查询数据库该用户是否存在，然后再比较登陆的密码是否正确</p>
<ol>
<li><p>首先编写根据用户名查询数据库的业务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 查询登陆用户</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> com.yue.entity.User</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> User <span class="title">selectUserByUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;查询登陆用户&quot;</span>);</span><br><span class="line">     QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;User&gt;();</span><br><span class="line">     wrapper.eq(<span class="string">&quot;username&quot;</span>,username);</span><br><span class="line">     User user = userMapper.selectOne(wrapper);</span><br><span class="line">     System.out.println(<span class="string">&quot;查询到:&quot;</span>+user);</span><br><span class="line">     <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在我们自定义的<code>Realm</code>认证流程中设置从数据库查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;开始认证&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 获得主体信息</span></span><br><span class="line">    String principal = (String) token.getPrincipal();</span><br><span class="line">    System.out.println(principal+<span class="string">&quot;进行认证&quot;</span>);</span><br><span class="line">    User user = userService.selectUserByUsername(principal);</span><br><span class="line">    System.out.println(<span class="string">&quot;用户认证:&quot;</span>+user);</span><br><span class="line">    <span class="keyword">if</span> (!ObjectUtils.isEmpty(user))&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;认证者密码:&quot;</span>+user.getPassword());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(user.getUsername(),user.getPassword(), ByteSource.Util.bytes(user.getSalt()),<span class="keyword">this</span>.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>修改<code>Shiro</code>核心配置文件，给<code>Realm</code>设置相应的凭证匹配器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Realm <span class="title">getRealm</span><span class="params">()</span></span>&#123;</span><br><span class="line">    MyRealm realm = <span class="keyword">new</span> MyRealm();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改凭证校验匹配器</span></span><br><span class="line">    HashedCredentialsMatcher hashedCredentialsMatcher = <span class="keyword">new</span> HashedCredentialsMatcher();</span><br><span class="line">    <span class="comment">// 设置为 md5 加密</span></span><br><span class="line">    hashedCredentialsMatcher.setHashAlgorithmName(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">    <span class="comment">// 设置散列次数</span></span><br><span class="line">    hashedCredentialsMatcher.setHashIterations(<span class="number">1024</span>);</span><br><span class="line">    realm.setCredentialsMatcher(hashedCredentialsMatcher);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> realm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="四、授权的基本操作"><a href="#四、授权的基本操作" class="headerlink" title="四、授权的基本操作"></a>四、授权的基本操作</h2><p>​        授权会走我们自定义<code>Realm</code>中的<code>doGetAuthenticationInfo</code>这个方法获取权限信息，如果没有权限的话可以直接返回<code>null</code>，如果返回了一个<code>AuthorizationInfo</code>的一个实现类可以返回它的权限信息。</p>
<h3 id="4-1-基于配置的授权"><a href="#4-1-基于配置的授权" class="headerlink" title="4.1 基于配置的授权"></a>4.1 基于配置的授权</h3><ol>
<li><p>之前没有在数据库中设置用户的权限，现在我们先给用户赋予角色和权限</p>
<img src="https://i0.hdslb.com/bfs/album/989864d5fcc0d0ee13a5b9176ad183e730c2a951.png@518w.png" alt="image-20201208173407959" style="zoom:67%;" /></li>
<li><p>在<code>Shiro</code>核心配置文件中设置那些页面需要那些权限才能访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">getShiroFilterFactoryBean</span><span class="params">(DefaultWebSecurityManager defaultWebSecurityManager)</span></span>&#123;</span><br><span class="line">    ShiroFilterFactoryBean shiroFilterFactoryBean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 给 ShiroFilterFactoryBean 设置安全管理器</span></span><br><span class="line">    shiroFilterFactoryBean.setSecurityManager(defaultWebSecurityManager);</span><br><span class="line">    shiroFilterFactoryBean.setLoginUrl(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">    <span class="comment">// 设置 受限资源</span></span><br><span class="line">    HashMap&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;/index&quot;</span>,<span class="string">&quot;authc&quot;</span>);  <span class="comment">// 请求这个资源要认证授权</span></span><br><span class="line">    map.put(<span class="string">&quot;/vip1&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;/vip2&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;/vip3&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;/vip4&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;/vip1&quot;</span>,<span class="string">&quot;perms[vip]&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;/vip2&quot;</span>,<span class="string">&quot;perms[vip]&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;/vip3&quot;</span>,<span class="string">&quot;roles[root]&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;/vip4&quot;</span>,<span class="string">&quot;roles[root]&quot;</span>);</span><br><span class="line">    shiroFilterFactoryBean.setFilterChainDefinitionMap(map);</span><br><span class="line">    <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在自定义<code>Realm</code>的<code>doGetAuthorizationInfo</code>授权方法中获取用户主体并查询数据库进行授权</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;开始授权&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取身份信息</span></span><br><span class="line">    String primaryPrincipal = (String) principals.getPrimaryPrincipal();</span><br><span class="line">    System.out.println(primaryPrincipal+<span class="string">&quot;进行授权&quot;</span>);</span><br><span class="line">    <span class="comment">// 根据身份信息获取 角色和权限 信息</span></span><br><span class="line">    User user = userService.selectUserByUsername(primaryPrincipal);</span><br><span class="line">    <span class="keyword">if</span> (!ObjectUtils.isEmpty(user))&#123;</span><br><span class="line">       SimpleAuthorizationInfo simpleAuthorizationInfo = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">       String perms = user.getPerms();</span><br><span class="line">       String role = user.getRole();</span><br><span class="line">       simpleAuthorizationInfo.addStringPermission(perms);</span><br><span class="line">       simpleAuthorizationInfo.addRole(role);</span><br><span class="line">       <span class="keyword">return</span> simpleAuthorizationInfo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>登陆测试</p>
<ul>
<li>用户<code>admin</code>，拥有<code>root</code>和<code>vip</code>的角色和权限所有可以访问所有页面</li>
<li>用户<code>user</code>，只拥有<code>vip</code>权限，所以他访问需要<code>root</code>才可以访问的页面：<code>vip3</code>、<code>vip4</code>时则抛出<code>401</code>权限不足异常</li>
</ul>
</li>
</ol>
<h3 id="4-2-基于注解的授权"><a href="#4-2-基于注解的授权" class="headerlink" title="4.2 基于注解的授权"></a>4.2 基于注解的授权</h3><p>​        在<code>Shiro</code>中为我们提供了五个权限注解：</p>
<ul>
<li><code>RequiresAuthentication</code><ul>
<li>使用该注解标注的类，实例，方法在访问或调用时，当前Subject必须在当前session中已经过认证</li>
</ul>
</li>
<li><code>RequiresGuest</code><ul>
<li>使用该注解标注的类，实例，方法在访问或调用时，当前Subject可以是“gust”身份，不需要经过认证或者在原先的session中存在记录</li>
</ul>
</li>
<li><code>RequiresPermissions</code><ul>
<li>当前Subject需要拥有某些特定的权限时，才能执行被该注解标注的方法。如果当前Subject不具有这样的权限，则方法不会被执行</li>
</ul>
</li>
<li><code>RequiresRoles</code><ul>
<li>当前<code>Subject</code>必须拥有所有指定的角色时，才能访问被该注解标注的方法。如果当天<code>Subject</code>不同时拥有所有指定角色，则方法不会执行还会抛出<code>AuthorizationException</code>异常</li>
</ul>
</li>
<li><code>RequiresUser</code><ul>
<li>当前<code>Subject</code>必须是应用的用户，才能访问或调用被该注解标注的类，实例，方法。</li>
</ul>
</li>
</ul>
<blockquote>
<p>使用演示：</p>
</blockquote>
<ol>
<li><p> 首先把我们之前在配置文件中的页面权限设置给注释掉，因为我们要使用注解来给请求设置权限</p>
</li>
<li><p> 在<code>PageController</code>控制器中的请求上添加相应的注解</p>
</li>
</ol>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/vip1&quot;)</span></span><br><span class="line"><span class="meta">@RequiresPermissions(&#123;&quot;vip&quot;&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">vip1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;进入VIP1&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;vip1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/vip2&quot;)</span></span><br><span class="line"><span class="meta">@RequiresPermissions(value = &#123;&quot;vip&quot;,&quot;vip2&quot;&#125;,logical = Logical.OR</span></span><br><span class="line"><span class="meta">public String vip2()&#123;</span></span><br><span class="line"><span class="meta">    System.out.println(&quot;进入VIP2&quot;);</span></span><br><span class="line"><span class="meta">    return &quot;vip2&quot;;</span></span><br><span class="line"><span class="meta">&#125;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/vip3&quot;)</span></span><br><span class="line"><span class="meta">@RequiresRoles(&quot;root&quot;)</span></span><br><span class="line"><span class="meta">public String vip3()&#123;</span></span><br><span class="line"><span class="meta">    System.out.println(&quot;进入VIP3&quot;);</span></span><br><span class="line"><span class="meta">    return &quot;vip3&quot;;</span></span><br><span class="line"><span class="meta">&#125;</span></span><br><span class="line"><span class="meta">                     </span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/vip4&quot;)</span></span><br><span class="line"><span class="meta">@RequiresRoles(value = &#123;&quot;root&quot;,&quot;admin&quot;&#125;,logical = Logical.OR)</span></span><br><span class="line"><span class="meta">public String vip4()&#123;</span></span><br><span class="line"><span class="meta">    System.out.println(&quot;进入VIP4&quot;);</span></span><br><span class="line"><span class="meta">    return &quot;vip4&quot;;</span></span><br><span class="line"><span class="meta">&#125;</span></span><br></pre></td></tr></table></figure>

<p>   <strong>注意：</strong>有些情况下，一个页面可能需要多个权限或者角色，而<code>RequiresPermissions</code>和<code>RequiresRoles</code>权限注解的<code>logical</code>默认是<code>AND</code>的也就是同时具备所有权限才能访问，我们可以修改成<code>OR</code>让他具备其中一个权限或者角色即可访问！</p>
<ol start="3">
<li><p>运行代码测试</p>
<ul>
<li><code>admin</code>可以访问所有页面</li>
<li><code>user</code>只可以访问<code>vip1</code>与<code>vip2</code></li>
</ul>
</li>
</ol>
<h3 id="4-3-基于标签的授权"><a href="#4-3-基于标签的授权" class="headerlink" title="4.3 基于标签的授权"></a>4.3 基于标签的授权</h3><p><code>Shiro</code>还为我们提供了基于前端的标签权限控制：</p>
<ul>
<li><code>&lt;div shiro:guest&gt;&lt;/div&gt;</code><ul>
<li>无需登陆即可访问</li>
</ul>
</li>
<li><code>&lt;div shiro:user&gt;&lt;/div&gt;</code><ul>
<li>用户已经通过登陆或记住我可以访问</li>
</ul>
</li>
<li><code>&lt;div &lt;shiro:authenticted&gt;&lt;/div&gt;</code><ul>
<li>身份认证通过可以访问</li>
</ul>
</li>
<li><code>&lt;div shiro:notAuthenticated&gt;&lt;/div&gt;</code><ul>
<li>没有进行身份认证可以访问</li>
</ul>
</li>
<li><code>&lt;div shiro:hashRole name = &quot;root&quot;&gt;&lt;/div&gt;</code><ul>
<li>具有<code>root</code>角色才显示可以访问</li>
</ul>
</li>
<li><code>&lt;div shiro:hasAnyRoles name = &quot;admin,root&quot;&gt;&lt;/div&gt;</code><ul>
<li>具有<code>admin</code>或<code>root</code>之一角色即可显示访问</li>
</ul>
</li>
<li><code>&lt;div shiro:lacksRole name = &quot;admin&quot;&gt;&lt;/div&gt;</code><ul>
<li>不具有<code>admin</code>角色则可以显示访问</li>
</ul>
</li>
<li><code>&lt;div shiro:hashPermission name = &quot;vip1&quot;&gt;&lt;/div&gt;</code><ul>
<li>具有<code>vip1</code>才可以显示访问</li>
</ul>
</li>
<li><code>&lt;div shiro:lacksPermission name = &quot;vip1&quot;&gt;&lt;/div&gt;</code><ul>
<li>不具有<code>vip1</code>才显示访问</li>
</ul>
</li>
</ul>
<blockquote>
<p>使用演示：</p>
</blockquote>
<ol>
<li><p>将上一步权限注解注释掉，想在<code>Thymeleaf</code>中使用<code>Shiro</code>标签首先要导入一个依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>在我们页面的标签上添加<code>Shiro</code>的标签</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;layui-nav layui-nav-tree layui-bg-cyan layui-inline&quot;</span> lay-filter=<span class="string">&quot;demo&quot;</span>&gt;</span><br><span class="line">    &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;layui-nav-item layui-nav-itemed&quot;</span>&gt;</span><br><span class="line">        &lt;a th:href=<span class="string">&quot;@&#123;/index&#125;&quot;</span>&gt;首页&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;div shiro:hasPermission name=<span class="string">&quot;vip&quot;</span>&gt;</span><br><span class="line">    &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;layui-nav-item&quot;</span>&gt;</span><br><span class="line">        &lt;a th:href=<span class="string">&quot;@&#123;/vip1&#125;&quot;</span>&gt;vip1&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;layui-nav-item&quot;</span>&gt;</span><br><span class="line">        &lt;a th:href=<span class="string">&quot;@&#123;/vip2&#125;&quot;</span>&gt;vip2&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;layui-nav-item&quot;</span>&gt;</span><br><span class="line">        &lt;div shiro:hasRole name=<span class="string">&quot;root&quot;</span>&gt;</span><br><span class="line">            &lt;a th:href=<span class="string">&quot;@&#123;/vip3&#125;&quot;</span>&gt;vip3&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;div shiro:hasAnyRole name=<span class="string">&quot;root,admin&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">    &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;layui-nav-item&quot;</span>&gt;</span><br><span class="line">        &lt;a th:href=<span class="string">&quot;@&#123;/vip4&#125;&quot;</span>&gt;vip4&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>启动测试</p>
</li>
</ol>
<h2 id="五、整合缓存的实现"><a href="#五、整合缓存的实现" class="headerlink" title="五、整合缓存的实现"></a>五、整合缓存的实现</h2><p>​        在以上的授权过程中，每一次请求一个网页都会走我们的授权过程，也就是每一次都要查询数据库然后再对主体进行授权操作，频繁的操作数据库性能和安全性都不稳定。</p>
<p>​        <code>Shiro</code>为我们提供了缓存技术，当我们进行授权过一次之后，就会把他的权限数据缓存起来，当二次访问时就不用再去数据库中获取，而是去缓存中获取。<code>Shiro</code>为我们提供了<code>CacheManager</code>接口，我们可以通过实现该接口去完成自定义缓存</p>
<blockquote>
<p>代码演示</p>
</blockquote>
<ol>
<li><p>导入所需要的缓存依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>在自定义<code>Realm</code>中开启缓存管理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Realm <span class="title">getRealm</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    MyRealm realm = <span class="keyword">new</span> MyRealm();</span><br><span class="line">    <span class="comment">// 修改凭证校验匹配器</span></span><br><span class="line">    HashedCredentialsMatcher hashedCredentialsMatcher = <span class="keyword">new</span> HashedCredentialsMatcher();</span><br><span class="line">    <span class="comment">// 设置为 md5 加密</span></span><br><span class="line">    hashedCredentialsMatcher.setHashAlgorithmName(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">    <span class="comment">// 设置散列次数</span></span><br><span class="line">    hashedCredentialsMatcher.setHashIterations(<span class="number">1024</span>);</span><br><span class="line">    realm.setCredentialsMatcher(hashedCredentialsMatcher);</span><br><span class="line">    <span class="comment">// 开启缓存管理器</span></span><br><span class="line">    realm.setCacheManager(<span class="keyword">new</span> EhCacheManager());</span><br><span class="line">    realm.setCachingEnabled(<span class="keyword">true</span>);  <span class="comment">// 开启全局缓存</span></span><br><span class="line">    realm.setAuthenticationCachingEnabled(<span class="keyword">true</span>);  <span class="comment">// 开启认证缓存</span></span><br><span class="line">    realm.setAuthorizationCachingEnabled(<span class="keyword">true</span>);   <span class="comment">// 开去授权缓存</span></span><br><span class="line">    <span class="keyword">return</span> realm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="六、整合Redis实现"><a href="#六、整合Redis实现" class="headerlink" title="六、整合Redis实现"></a>六、整合Redis实现</h2><p>​        在上面我们使用的是<code>Shiro</code>为我们提供的全局缓存管理器<code>EhCacheManager</code>，我们可以自定义我们自己的缓存，使用<code>Redis</code>来代替它提供的缓存管理器</p>
<ol>
<li><p>引入<code>Redis</code>依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>添加<code>redis</code>的配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis</span></span><br><span class="line"><span class="attr">redis:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">xxxxxxx</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">  <span class="attr">lettuce:</span></span><br><span class="line">    <span class="attr">shutdown-timeout:</span> <span class="number">1000</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">xxxxxx</span></span><br></pre></td></tr></table></figure></li>
<li><p>编写自定义缓存管理器：<code>redisCache</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义 redis 缓存管理器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisCacheManager</span> <span class="keyword">implements</span> <span class="title">CacheManager</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;K, V&gt; <span class="function">Cache&lt;K, V&gt; <span class="title">getCache</span><span class="params">(String s)</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        通过实现<code>CacheManager</code>来自定义一个缓存管理器，这里先返回空，所以任何用户来访问这个缓存管理器都获取不到数据。我们先打印一下它的参数查看一下参数是什么。</p>
</li>
<li><p>修改<code>ShiroConfig</code>核心配置文件，配置缓存管理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Realm <span class="title">getRealm</span><span class="params">()</span></span>&#123;</span><br><span class="line">        MyRealm realm = <span class="keyword">new</span> MyRealm();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改凭证校验匹配器</span></span><br><span class="line">        HashedCredentialsMatcher hashedCredentialsMatcher = <span class="keyword">new</span> HashedCredentialsMatcher();</span><br><span class="line">        <span class="comment">// 设置为 md5 加密</span></span><br><span class="line">        hashedCredentialsMatcher.setHashAlgorithmName(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置散列次数</span></span><br><span class="line">        hashedCredentialsMatcher.setHashIterations(<span class="number">1024</span>);</span><br><span class="line">        realm.setCredentialsMatcher(hashedCredentialsMatcher);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开启缓存管理器</span></span><br><span class="line">        realm.setCacheManager(<span class="keyword">new</span> RedisCacheManager());</span><br><span class="line">        realm.setCachingEnabled(<span class="keyword">true</span>);  <span class="comment">// 开启全局缓存</span></span><br><span class="line">        realm.setAuthenticationCachingEnabled(<span class="keyword">true</span>);  <span class="comment">// 开启认证缓存</span></span><br><span class="line">        realm.setAuthorizationCachingEnabled(<span class="keyword">true</span>);   <span class="comment">// 开去授权缓存</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> realm;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>经过运行发现<code>getCache</code>方法的参数为认证或是授权缓存的统一名称</p>
</li>
<li><p>这里<code>Cache</code>也是一个接口，我们要自定义一个<code>RedisCache</code>来实现这个接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisCache</span>&lt;<span class="title">k</span>,<span class="title">v</span>&gt; <span class="keyword">implements</span> <span class="title">Cache</span>&lt;<span class="title">k</span>,<span class="title">v</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Object o)</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">put</span><span class="params">(Object o, Object o2)</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">remove</span><span class="params">(Object o)</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set <span class="title">keys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection <span class="title">values</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>然后要做的就是把这些方法换成<code>redis</code>的实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Object o)</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">    redisTemplate.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.opsForValue().get(o.toString());</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">put</span><span class="params">(Object o, Object o2)</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;key:&quot;</span>+o);</span><br><span class="line">    redisTemplate.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">    redisTemplate.opsForValue().set(o.toString(), o2);</span><br><span class="line">    System.out.println(<span class="string">&quot;val:&quot;</span>+o2);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：这里要把我们的对象进行序列化</p>
<h2 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h2><ul>
<li><a src = "https://yueblog.top/2020/12/02/shiro(%E4%B8%80)%E6%8E%88%E6%9D%83/"><code>Shiro(一):授权</code></a></li>
<li><a src = "https://yueblog.top/2020/12/03/shiro(%E4%BA%8C)%E8%87%AA%E5%AE%9A%E4%B9%89Reaml%E4%B8%8E%E5%8A%A0%E5%AF%86/"><code>Shiro(二):自定义Realm与加密</code></a></li>
<li><a src = "https://yueblog.top/2020/12/03/shiro(%E4%B8%89)%E8%AE%A4%E8%AF%81/"><code>Shiro(三):认证</code></a></li>
<li><a src = "https://yueblog.top/2020/12/05/shiro(%E5%9B%9B)%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"><code>Shiro(四):认证源码分析</code></a></li>
<li><a src = "#"><code>Shiro(五):整合SpringBoot</code></a></li>
</ul>
<p>​        到这里所有<code>shiro</code>的使用教程就结束了，<code>Shiro</code>的功能当然不仅仅于此剩下的要自己进行探究。相对于<code>SpringSecurity</code>来说<code>Shiro</code>的确要轻便的很多，但是<code>Shiro</code>的功能却没有<code>SpringSecurity</code>强大，对于一个优秀的码农这两种权限框架肯定时要同时掌握的。</p>
<p>该页代码：</p>
<p>​    链接：<code>https://pan.baidu.com/s/1WRHfvthxTKOi7Hxedmzpgw </code><br>​    提取码：<code>smkg</code> </p>
</li>
</ol>
</div><div class="tags"><a href="/tags/%E7%AC%94%E8%AE%B0/"><i class="fa fa-tag"></i>笔记</a></div><div class="post-nav"><a class="pre" href="/2021/07/11/hello-world/">Hello World</a><a class="next" href="/2020/12/05/shiro(%E5%9B%9B)%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Shiro入门(四)：认证源码分析</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://example.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JWT/">JWT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Web/">Java-Web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaWeb/">JavaWeb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Leetcode/">Leetcode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MyBatis/">MyBatis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Shiro/">Shiro</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vue/">Vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/html/">html</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/json/">json</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 15px;">笔记</a> <a href="/tags/JWT/" style="font-size: 15px;">JWT</a> <a href="/tags/Leetcode/" style="font-size: 15px;">Leetcode</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/%E5%BC%82%E5%B8%B8%E6%97%A5%E5%BF%97/" style="font-size: 15px;">异常日志</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 15px;">数据库</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 15px;">多线程</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/07/11/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/07/shiro(%E4%BA%94)%E6%95%B4%E5%90%88SpringBoot/">Shiro入门(五)：整合SpringBoot</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/05/shiro(%E5%9B%9B)%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Shiro入门(四)：认证源码分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/03/shiro(%E4%B8%89)%E8%AE%A4%E8%AF%81/">Shiro入门(三)：授权</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/03/shiro(%E4%BA%8C)%E8%87%AA%E5%AE%9A%E4%B9%89Reaml%E4%B8%8E%E5%8A%A0%E5%AF%86/">Shiro入门(二)：自定义Reaml与加密</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/02/shiro(%E4%B8%80)%E6%8E%88%E6%9D%83/">Shiro入门(一)：授权</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/19/Vue%E8%BF%9B%E9%98%B6/">Vue进阶</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/19/JWT%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/">JWT快速入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/16/Leetcode-01-%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C/">Leetcode-01-两数之和</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/10/16/Vue%E5%85%A5%E9%97%A8/">Vue-入门</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">岳争.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>